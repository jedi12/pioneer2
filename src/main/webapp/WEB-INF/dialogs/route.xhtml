<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<h:form id="editDialog" target="_blank">
		<p:dialog widgetVar="editDialog" resizable="false" width="1024" modal="true" onShow="formatDialog()">
			<f:facet name="header">
				<i class="fa fa-fw fa-share-alt" style="margin-right:10px"/>
				<p:outputLabel value="#{text['route.edit.header']} (#{text['label.id']} #{routeView.currRoute.id})"/>
			</f:facet>

			<h2 align="center">
				<h:outputLabel value="#{routeView.currRoute.createFlag ? text['route.edit.create'] : text['route.edit.change']}"/>
			</h2>

			<p:panel>
				<h:panelGrid id="routeNameGrid" columns="3" cellpadding="5" width="100%" columnClasses="labelNoWrap,width100,width38px">
					<p:outputLabel value="#{text['route.edit.label.name']}" for="routeName"/>
					<p:inputText id="routeName" value="#{routeView.currRoute.name}" styleClass="width100" maxlength="64"
								 validator="notEmptyString" disabled="#{routeView.currRoute.state > 1}"/>
					<p:message for="routeName" display="icon" styleClass="width38px"/>
				</h:panelGrid>

				<p:tabView id="tabView" onTabShow="formatChoiceList()">
					<p:tab title="#{text['route.edit.tab.point']}">
						<p:panel styleClass="scrollPanel" style="border: 0;padding: 0;overflow-y: auto;overflow-x: hidden;height: inherit">
							<p:dataTable id="listsTable" value="#{routeView.currRoute.points}" var="collectedList" rows="10"
										 emptyMessage="#{text['table.empty']}" styleClass="collectedTable" sortBy="#{collectedList.stage}"
										 paginator="true" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport} {FirstPageLink}
										 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
										 currentPageReportTemplate="#{text['table.total']} {totalRecords}">

								<p:column>
									<f:facet name="header">
										<h:outputText value="#{text['route.edit.col.stage']}"/>
									</f:facet>
									<h:outputText value="#{collectedList.stage}"/>
								</p:column>

								<p:column>
									<f:facet name="header">
										<h:outputText value="#{text['route.edit.col.point.name']}"/>
									</f:facet>
									<h:outputText value="#{collectedList.groupName}"/>
								</p:column>

								<p:column>
									<f:facet name="header">
										<h:outputText value="#{text['route.edit.col.role']}"/>
									</f:facet>
									<h:outputText value="#{collectedList.roleName}"/>
								</p:column>

								<p:column width="15%" styleClass="columnCenter">
									<f:facet name="header">
										<h:outputText value="#{text['operation.name']}"/>
									</f:facet>
									<p:commandLink value="#{text['operation.delete']}" update="listsTable :editDialog:tabView:addValueGrid"
												   actionListener="#{routeView.removeValue(collectedList)}"	process="@this"
												   oncomplete="formatChoiceList()">
										<p:collector value="#{collectedList}" removeFrom="#{routeView.currRoute.points}" unique="true"/>
									</p:commandLink>
								</p:column>
							</p:dataTable>

							<br />

							<p:panel styleClass="ui-widget-header" style="padding: .5em 1em">
								<h:panelGrid id="addValueGrid" columns="2" width="100%" columnClasses="labelNoWrap,width100,width38px">
									<p:outputLabel value="#{text['route.edit.label.stage']}" for="addStage"/>
									<p:spinner id="addStage" value="#{routeView.stage}" min="1" max="200" maxlength="3" size="3"
											   validator="notEmptyString"/>

									<p:outputLabel value="#{text['route.edit.label.point']}" for="addValue"/>
									<p:selectOneMenu id="addValue" value="#{routeView.selectedPoint}" styleClass="width100" effect="fade"
													 filter="true" filterMatchMode="contains">
										<f:selectItems value="#{routeView.selectPoint}" />
									</p:selectOneMenu>

									<p:commandButton value="#{text['operation.add']}" icon="fa fa-fw fa-plus" update="listsTable addValueGrid"
													 process="listsTable addValueGrid" actionListener="#{routeView.addValue}"
													 oncomplete="formatChoiceList()"/>
								</h:panelGrid>
							</p:panel>
						</p:panel>
					</p:tab>

					<p:tab title="#{text['route.edit.tab.restriction']}">
						<p:panel styleClass="scrollPanel" style="border: 0;padding: 0;overflow-y: auto;overflow-x: hidden;height: inherit">
							<p:dataTable id="resTable" value="#{routeView.currRoute.groups}" var="collectedGroup" rows="10"
										 emptyMessage="#{text['table.empty']}" styleClass="collectedTable" sortBy="#{collectedGroup.groupName}"
										 paginator="true" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport} {FirstPageLink}
										 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
										 currentPageReportTemplate="#{text['table.total']} {totalRecords}">

								<p:column>
									<f:facet name="header">
										<h:outputText value="#{text['route.edit.col.group.name']}"/>
									</f:facet>
									<h:outputText value="#{collectedGroup.groupName}"/>
								</p:column>

								<p:column width="15%" styleClass="columnCenter">
									<f:facet name="header">
										<h:outputText value="#{text['operation.name']}"/>
									</f:facet>
									<p:commandLink value="#{text['operation.delete']}" update="resTable :editDialog:tabView:addGroupGrid"
												   actionListener="#{routeView.removeGroup(collectedGroup)}" process="@this"
												   oncomplete="formatChoiceList()">
										<p:collector value="#{collectedGroup}" removeFrom="#{routeView.currRoute.groups}" unique="true"/>
									</p:commandLink>
								</p:column>
							</p:dataTable>

							<br />

							<p:panel styleClass="ui-widget-header" style="padding: .5em 1em">
								<h:panelGrid id="addGroupGrid" columns="2" width="100%" columnClasses="labelNoWrap,width100,width38px">
									<p:outputLabel value="#{text['route.edit.label.group']}" for="addGroupValue"/>
									<p:selectOneMenu id="addGroupValue" value="#{routeView.selectedGroup}" styleClass="width100" effect="fade"
													 filter="true" filterMatchMode="contains">
										<f:selectItems value="#{routeView.selectGroup}" />
									</p:selectOneMenu>

									<p:commandButton value="#{text['operation.add']}" icon="fa fa-fw fa-plus" update="resTable addGroupGrid"
													 process="resTable addGroupGrid" actionListener="#{routeView.addGroup}"
													 oncomplete="formatChoiceList()"/>
								</h:panelGrid>
							</p:panel>
						</p:panel>
					</p:tab>
				</p:tabView>

				<f:facet name="footer">
					<h:panelGrid columns="2" columnClasses=",columnRight" style="width: 100%">
						<p:commandButton value="#{text['button.save']}" icon="fa fa-fw fa-check"
										 update=":centerPanel:routeTable routeNameGrid"
										 actionListener="#{routeView.saveAction}" process="@this routeNameGrid"/>
						<p:commandButton value="#{text['button.cancel']}" icon="fa fa-fw fa-close" type="button"
										 onclick="PF('editDialog').hide();"/>
						</h:panelGrid>
				</f:facet>
			</p:panel>
		</p:dialog>
	</h:form>

	<h:form id="deleteDialog" target="_blank">
		<p:dialog widgetVar="deleteDialog" resizable="false" modal="true" width="1024" onShow="formatDialog()">
			<f:facet name="header">
				<i class="fa fa-fw fa-share-alt"/>
				<p:outputLabel value=" #{text['route.del.header']} (ID: #{routeView.selectedRoute.id})"/>
			</f:facet>

			<h2 align="center"><h:outputLabel value="#{text['route.del.delete']}"/></h2>
			<p:panel>
				<p:panel styleClass="scrollPanel" style="border: 0;padding: 0;overflow-y: auto;overflow-x: hidden;height: inherit">
					<h:panelGrid columns="2" cellpadding="5">
						<p:outputLabel value="#{text['route.del.title']}"/>
						<p:outputLabel value="#{routeView.selectedRoute.name}" style="font-weight: bold"/>
					</h:panelGrid>

					<h:panelGroup rendered="#{!routeView.templatesWithRoute.isEmpty()}">
						<hr/>
						<h4 align="center">#{text['route.del.templatesWithRoute']}</h4>
						<p:repeat value="#{routeView.templatesWithRoute}" var="template" >
							<i><h:outputLabel value="#{template}"/></i>
							<br/>
						</p:repeat>
					</h:panelGroup>
				</p:panel>

				<f:facet name="footer">
					<h:panelGrid columns="2" columnClasses=",columnRight" style="width: 100%">
						<p:commandButton value="#{text['button.delete']}" icon="fa fa-fw fa-check"
										 update=":centerPanel:routeTable" actionListener="#{routeView.deleteAction}"
										 disabled="#{!routeView.templatesWithRoute.isEmpty()}"/>
						<p:commandButton value="#{text['button.cancel']}" icon="fa fa-fw fa-close" type="button"
										 onclick="PF('deleteDialog').hide();"/>
					</h:panelGrid>
				</f:facet>
			</p:panel>
		</p:dialog>
	</h:form>
</ui:composition>